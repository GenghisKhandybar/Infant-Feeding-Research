---
title: "mother-descriptive-statistics"
author: "William Medwid"
date: "7/22/2021"
output: html_document
---

This analysis excludes bottle rejectors.

```{r setup, include=FALSE}
include_rejectors <- c(0)
source("shared_setup.R")
```

```{r}
mother_narrow <- data_dyad_total_zeros %>% 
  filter(dyad_unit == "Mom") %>% 
  distinct(Narrow_group) %>% 
  pull()

for(behavior_type in mother_narrow){
  p <- data_dyad_total_zeros %>%
    filter(dyad_unit == "Mom") %>% 
    filter(Narrow_group==behavior_type) %>% 
    mutate(Behavior = reorder(Behavior, num_per_min)) %>% 
    #filter(num_per_min < 2) %>% 
    ggplot(aes(y=Behavior, x=num_per_min, col=dyad_set)) +
    geom_boxplot(outlier.alpha = 0.25, outlier.size = 1) +
    ggtitle(paste(behavior_type, "behavior frequency distributions by age")) + 
    xlab("Behaviors per minute")
  print(p)
}
```

In these plots, everything is treated as a state point behavior. Maybe it'd be more useful to separate the duration behaviors, but here we get a more direct comparison.

```{r}
data_dyad_total_zeros %>%
  filter(dyad_unit == "Mom") %>% 
  filter(!(Behavior %in% bottle_states)) %>% 
  group_by(dyad_set, id, Narrow_group) %>% 
  summarise(sum_num_per_min = sum(num_per_min)) %>% 
  mutate(Narrow_group = reorder(Narrow_group, sum_num_per_min, median)) %>% 
  #filter(num_per_min < 2) %>% 
  ggplot(aes(y=Narrow_group, x=sum_num_per_min, col=dyad_set)) +
  geom_boxplot(outlier.alpha = 0.25, outlier.size = 1) +
  ggtitle("Mothers' behavior frequency distributions by behavior group") + 
  xlab("Behaviors per minute")
```

The main trends we can see are, encouragement is more often used on younger babies while responsive behavior is more often given to older infants.

```{r}
states <- data_duration %>%
  filter(dyad_unit == "Mom") %>% 
  filter(!(Behavior %in% bottle_states)) %>% 
  filter(Narrow_group!="Baseline") %>%
  filter(Event_Type == "State start") %>% 
  distinct(Behavior) %>% 
  pull()


total_fractions <- data_duration %>%
  filter(Behavior %in% states) %>% 
  filter(Event_Type == "State start") %>%
  group_by(id, dyad_set, Behavior) %>% 
  summarise(total_fraction = sum(duration_fraction))

total_fractions <- total_fractions %>% 
  expand(nesting(id, dyad_set), Behavior = states) %>%
  left_join(total_fractions, on=c(id, dyad_set, Behavior)) %>%
  replace_na(list(total_fraction = 0)) %>% 
  group_by(Behavior, dyad_set) %>% 
  summarise(mean_fraction = mean(total_fraction))

  
#total_fractions %>% group_by(dyad_set) %>% summarise(s = sum(mean_fraction))

p <- total_fractions %>% 
  ggplot(aes(x=dyad_set, y=mean_fraction, group=Behavior, color=Behavior)) +
  geom_path() + 
  geom_point() +
  ylab("Mean Fraction of Time in State") +
  xlab("Dyad Set") +
  ggtitle("Proportion of time exhibiting certain behaviors")

p %>% ggplotly()
```

This confirms expected trends of more mature behaviors increasing over time while burping decreases. Each of these are very small fractions of the feeding time, but still significant.

```{r}
line_plot <- function(group){
  p <- data_dyad_total_zeros %>% 
    mutate(any_occurances = if_else(num_occurrences>0, 1, 0)) %>% 
    filter(Wide_group==group) %>% 
    group_by(Behavior, dyad_set, Narrow_group) %>% 
    summarise(prop_occurances = round(mean(any_occurances), 2)) %>% 
    ggplot(aes(x=dyad_set, 
               y=prop_occurances, 
               color=Behavior,
               group=Behavior)) +
    geom_point()+
    geom_line() +
    ylim(0, 1) +
    ggtitle(paste("Proportion of mothers performing", group, "actions")) +
    ylab("Proportion expressing cue at least once") +
    xlab("Baby age")
  
  p %>% ggplotly()
}

line_plot("Responsive")
line_plot("Controlling")
line_plot("Uninvolved")
```

One unusual finding here is that among four behaviors(3 controlling, one responsive), there is a sharp decrease in frequency from 2 months to 4 months, then a rebound at 6 months. Any ideas why this might be?